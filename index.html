<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Laboratory - Interactive 3D Science Experiments</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”¬ Virtual Laboratory</h1>
            <p>Interactive 3D Science Experiments</p>
        </header>

        <div id="experiments-container" class="loading">
            Loading experiments...
        </div>

        <div class="admin-link">
            <a href="admin/">Admin Panel</a>
        </div>
    </div>

    <script>
        async function loadExperiments() {
            try {
                const response = await fetch('admin/experiments.json.php');
                
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.message || 'Failed to load experiments');
                }
                
                const experiments = Array.isArray(data) ? data : [];
                const container = document.getElementById('experiments-container');
                
                if (experiments.length === 0) {
                    container.className = 'empty-state';
                    container.innerHTML = `
                        <h2>No Experiments Available</h2>
                        <p>Get started by creating your first experiment in the admin panel.</p>
                        <a href="admin/">Go to Admin Panel</a>
                    `;
                    return;
                }

                container.className = 'experiments-grid';
                container.innerHTML = experiments.map(exp => `
                    <div class="experiment-card">
                        <h3>${escapeHtml(exp.title)}</h3>
                        <div class="meta">
                            <span class="badge ${exp.subject.toLowerCase()}">${escapeHtml(exp.subject)}</span>
                            <span>Class ${escapeHtml(exp.class)}</span>
                            <span>${exp.steps?.length || 0} steps</span>
                        </div>
                        <div class="description">
                            ${escapeHtml(exp.description || 'Interactive 3D experiment simulation')}
                        </div>
                        <a href="experiment.html?id=${exp.id}" class="btn">
                            <span>Start Experiment</span>
                        </a>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load experiments:', error);
                let errorMessage = 'Please check the admin panel or try again later.';
                if (error.message && error.message.includes('JSON')) {
                    errorMessage = 'Server error: Invalid response from server. Please check if the database is properly configured.';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                document.getElementById('experiments-container').innerHTML = 
                    `<div class="empty-state"><h2>Error Loading Experiments</h2><p>${errorMessage}</p><a href="admin/index.php">Go to Admin Panel</a></div>`;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        loadExperiments();
    </script>
</body>
</html>
